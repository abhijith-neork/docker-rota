$(document).ready(function(){function e(e,t){var a=[];a.push(e);for(var n=moment(e).startOf("day"),d=moment(t).startOf("day");n.add(1,"days").diff(d)<0;){var r=n.clone().toDate();date=moment(r).format("YYYY-MM-DD"),a.push(date)}return e!=t&&a.push(t),a}function t(){$("#progressbar").css("display",""),console.log("start")}function a(){setTimeout(function(){$("#progressbar").css("display","none"),console.log("end")},1e3)}function n(){$(".fc-divider").each(function(){console.log("dd");var e=$(this).find("span.fc-cell-text").text();if(console.log(e+"ooo"),e&&$(this).find("span.fc-cell-text").text()==e){var t=function(e){var t="";return $.each(designaton_names,function(a,n){a==e&&(t=n)}),t}(e);$(this).find("span.fc-cell-text").text(t)}})}$("#calendar").fullCalendar({resourceGroupField:"designation_id",height:"auto",resourceAreaWidth:350,editable:!1,eventLimit:!0,filterResourcesWithEvents:!0,refetchResourcesOnNavigate:!0,aspectRatio:3,scrollTime:"00:00",header:{left:"promptResource today prev,next",center:"title",right:" "},titleFormat:"[Schedule for week] - ddd D/MM/YYYY [: "+unit+"]",eventRender:function(e,t,a){var n=t.find(".fc-title");n.html(n.text())},eventAfterAllRender:function(e,t,a){console.log("Done"),$("#img-loader-data").hide(),showHolidayAndTrainings();},events:weekEvents,firstDay:0,defaultView:"customWeek",views:{customWeek:{type:"timeline",duration:{weeks:1},slotDuration:{days:1},buttonText:"Custom Week"}},loading:function(e){e?console.log("loading"):console.log("done")},resourceColumns:[{labelText:"Employees",field:"title"}],resources:function(t){var a=$("#calendar").fullCalendar("getCalendar").view,n=a.start._d;let d=JSON.stringify(n);sdate=d.slice(1,11);var r=a.end._d;let l=JSON.stringify(r);if(edate=l.slice(1,11),$("#start").val(sdate),$("#end").val(edate),e(sdate,edate).length>7){var o=new Date(edate);o.setDate(o.getDate()-1),edate=new Date(o).toISOString().slice(0,10)}console.log("RES");var s=$("#unit").val();$.ajax({url:baseURL+"admin/rota/getweekResources",type:"POST",async:!1,data:{unit_id:s,start_date:sdate,end_date:edate}}).done(function(e){console.log("done"),t(e.resources)})},resourceRender:function(e,t){}}),$(document).on("change",".SelectUnit",function(e){var t=$(this),a=$("#calendar").fullCalendar("getCalendar").view,n=a.start._d;let d=JSON.stringify(n);sdate=d.slice(1,11);var r=a.end._d;let l=JSON.stringify(r);edate=l.slice(1,11),$("#start").val(sdate),$("#end").val(edate),$("#unit_id").val(t.val());var o=t.val();$.ajax({url:baseURL+"admin/rota/getRotaId",type:"POST",async:!1,data:{unit_id:o,start_date:sdate,end_date:edate}}).done(function(e){$("#rota_id").val(e)}),$("#frmViewRota").submit()}),$(document).on("click",".fc-prev-button",function(e){t(),$("#start").val(""),$("#end").val("");var d=$("#calendar").fullCalendar("getCalendar");$("#calendar").fullCalendar("refetchResources");var r=d.view,l=r.start._d;let o=JSON.stringify(l);sdate=o.slice(1,11);var s=r.end._d;s.setDate(s.getDate()-1);let i=JSON.stringify(s);edate=i.slice(1,11),$("#start").val(sdate),$("#end").val(edate);var c=$("#unit").val();$.ajax({url:baseURL+"admin/rota/getweekSchedule",type:"POST",async:!1,data:{unit_id:c,start_date:sdate,end_date:edate},success:function(e){$("#calendar").fullCalendar("removeEvents"),$("#calendar").fullCalendar("removeEventSource",weekEvents),$("#calendar").fullCalendar("removeEventSource",e.events),$("#calendar").fullCalendar("addEventSource",e.events),resources=e.resources,n(),e.rotaId?$("#rota_id").val(e.rotaId):$("#rota_id").val(""),a()}})}),$(document).on("click",".fc-next-button ",function(e){t(),$("#start").val(""),$("#end").val(""),console.log("next loading");var d=$("#calendar").fullCalendar("getCalendar");$("#calendar").fullCalendar("refetchResources");var r=d.view,l=r.start._d;let o=JSON.stringify(l);sdate=o.slice(1,11);var s=r.end._d;s.setDate(s.getDate()-1);let i=JSON.stringify(s);edate=i.slice(1,11),$("#start").val(sdate),$("#end").val(edate);var c=$("#unit").val();$.ajax({url:baseURL+"admin/rota/getweekSchedule",type:"POST",async:!1,data:{unit_id:c,start_date:sdate,end_date:edate},beforeSend:function(){},success:function(e){$("#calendar").fullCalendar("removeEvents"),$("#calendar").fullCalendar("removeEventSource",weekEvents),$("#calendar").fullCalendar("removeEventSource",e.events),$("#calendar").fullCalendar("addEventSource",e.events),resources=e.resources,n(),e.rotaId?$("#rota_id").val(e.rotaId):$("#rota_id").val(""),console.log("next done"),a()}})}),$(document).on("click",".btn-edit",function(e){event.preventDefault(),t();var a=$("#rota_id").val(),n=$("#unit_id").val();console.log(n);var d=$("#start").val(),r=($("#end").val(),new Date(d));r.setDate(r.getDate()+6);var l=new Date(r).toISOString().split("T")[0];""!=a&&(window.location=baseURL+"admin/rota/editrotaview/"+n+"/"+d+"/"+l+"/"+a)}),$(document).on("click","#update_users",function(e){event.preventDefault();var t=$("#rota_id").val(),a=$("#unit_id").val();console.log(t),console.log(a),""!=t&&(window.location=baseURL+"admin/rota/updateUsers/"+t+"/"+a)}),n()});